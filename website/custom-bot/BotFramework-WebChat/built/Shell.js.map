{"version":3,"file":"Shell.js","sourceRoot":"","sources":["../src/Shell.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { ChatState, FormatState } from './Store';\nimport { User } from 'botframework-directlinejs';\nimport { classList } from './Chat';\nimport { Dispatch, connect } from 'react-redux';\nimport { Strings } from './Strings';\nimport { Speech } from './SpeechModule'\nimport { ChatActions, ListeningState, sendMessage, sendFiles } from './Store';\n\ninterface Props {\n    inputText: string,\n    strings: Strings,\n    listeningState: ListeningState,\n    showUploadButton: boolean\n\n    onChangeText: (inputText: string) => void\n\n    sendMessage: (inputText: string) => void,\n    sendFiles: (files: FileList) => void,\n    stopListening: () => void,\n    startListening: () => void\n}\n\nexport interface ShellFunctions {\n    focus: (appendKey?: string) => void\n}\n\nclass ShellContainer extends React.Component<Props> implements ShellFunctions {\n    private textInput: HTMLInputElement;\n    private fileInput: HTMLInputElement;\n\n    private sendMessage() {\n        if (this.props.inputText.trim().length > 0) {\n            this.props.sendMessage(this.props.inputText);\n        }\n    }\n\n    private handleSendButtonKeyPress(evt: React.KeyboardEvent<HTMLButtonElement>) {\n        if (evt.key === 'Enter' || evt.key === ' ') {\n            evt.preventDefault();\n            this.sendMessage();\n            this.textInput.focus();\n        }\n    }\n\n    private handleUploadButtonKeyPress(evt: React.KeyboardEvent<HTMLLabelElement>) {\n        if (evt.key === 'Enter' || evt.key === ' ') {\n            evt.preventDefault();\n            this.fileInput.click();\n        }\n    }\n\n    private onKeyPress(e: React.KeyboardEvent<HTMLInputElement>) {\n        if (e.key === 'Enter') {\n            this.sendMessage();\n        }\n    }\n\n    private onClickSend() {\n        this.sendMessage();\n    }\n\n    private onChangeFile() {\n        this.props.sendFiles(this.fileInput.files);\n        this.fileInput.value = null;\n        this.textInput.focus();\n    }\n\n    private onTextInputFocus(){\n        if (this.props.listeningState === ListeningState.STARTED) {\n            this.props.stopListening();\n        }\n    }\n\n    private onClickMic() {\n        if (this.props.listeningState === ListeningState.STARTED) {\n            this.props.stopListening();\n        } else if (this.props.listeningState === ListeningState.STOPPED) {\n            this.props.startListening();\n        }\n    }\n\n    public focus(appendKey?: string) {\n        this.textInput.focus();\n\n        if (appendKey) {\n            this.props.onChangeText(this.props.inputText + appendKey);\n        }\n    }\n\n    render() {\n        const className = classList(\n            'wc-console',\n            this.props.inputText.length > 0 && 'has-text',\n            this.props.showUploadButton && 'has-upload-button'\n        );\n\n        const showMicButton = this.props.listeningState !== ListeningState.STOPPED || (Speech.SpeechRecognizer.speechIsAvailable()  && !this.props.inputText.length);\n\n        const sendButtonClassName = classList(\n            'wc-send',\n            showMicButton && 'hidden'\n        );\n\n        const micButtonClassName = classList(\n            'wc-mic',\n            !showMicButton && 'hidden',\n            this.props.listeningState === ListeningState.STARTED && 'active',\n            this.props.listeningState !== ListeningState.STARTED && 'inactive'\n        );\n\n        const placeholder = this.props.listeningState === ListeningState.STARTED ? this.props.strings.listeningIndicator : this.props.strings.consolePlaceholder;\n\n        return (\n            <div className={ className }>\n                {\n                    this.props.showUploadButton &&\n                        <label\n                            className=\"wc-upload\"\n                            htmlFor=\"wc-upload-input\"\n                            onKeyPress={ evt => this.handleUploadButtonKeyPress(evt) }\n                            tabIndex={ 0 }\n                        >\n                            <svg>\n                                <path d=\"M19.96 4.79m-2 0a2 2 0 0 1 4 0 2 2 0 0 1-4 0zM8.32 4.19L2.5 15.53 22.45 15.53 17.46 8.56 14.42 11.18 8.32 4.19ZM1.04 1L1.04 17 24.96 17 24.96 1 1.04 1ZM1.03 0L24.96 0C25.54 0 26 0.45 26 0.99L26 17.01C26 17.55 25.53 18 24.96 18L1.03 18C0.46 18 0 17.55 0 17.01L0 0.99C0 0.45 0.47 0 1.03 0Z\" />\n                            </svg>\n                        </label>\n                }\n                {\n                    this.props.showUploadButton &&\n                        <input\n                            id=\"wc-upload-input\"\n                            tabIndex={ -1 }\n                            type=\"file\"\n                            ref={ input => this.fileInput = input }\n                            multiple\n                            onChange={ () => this.onChangeFile() }\n                            aria-label={ this.props.strings.uploadFile }\n                            role=\"button\"\n                        />\n                }\n                <div className=\"wc-textbox\">\n                    <input\n                        type=\"text\"\n                        className=\"wc-shellinput\"\n                        ref={ input => this.textInput = input }\n                        autoFocus\n                        value={ this.props.inputText }\n                        onChange={ _ => this.props.onChangeText(this.textInput.value) }\n                        onKeyPress={ e => this.onKeyPress(e) }\n                        onFocus={ () => this.onTextInputFocus() }\n                        placeholder={ placeholder }\n                        aria-label={ this.props.inputText ? null : placeholder }\n                        aria-live=\"polite\"\n                    />\n                </div>\n                <button\n                    className={ sendButtonClassName }\n                    onClick={ () => this.onClickSend() }\n                    aria-label={ this.props.strings.send }\n                    role=\"button\"\n                    onKeyPress={ evt => this.handleSendButtonKeyPress(evt) }\n                    tabIndex={ 0 }\n                    type=\"button\"\n                >\n                    <svg>\n                        <path d=\"M26.79 9.38A0.31 0.31 0 0 0 26.79 8.79L0.41 0.02C0.36 0 0.34 0 0.32 0 0.14 0 0 0.13 0 0.29 0 0.33 0.01 0.37 0.03 0.41L3.44 9.08 0.03 17.76A0.29 0.29 0 0 0 0.01 17.8 0.28 0.28 0 0 0 0.01 17.86C0.01 18.02 0.14 18.16 0.3 18.16A0.3 0.3 0 0 0 0.41 18.14L26.79 9.38ZM0.81 0.79L24.84 8.79 3.98 8.79 0.81 0.79ZM3.98 9.37L24.84 9.37 0.81 17.37 3.98 9.37Z\" />\n                    </svg>\n                </button>\n                <button\n                    className={ micButtonClassName }\n                    onClick={ () => this.onClickMic() }\n                    aria-label={ this.props.strings.speak }\n                    role=\"button\"\n                    tabIndex={ 0 }\n                    type=\"button\"\n                >\n                   <svg width=\"28\" height=\"22\" viewBox=\"0 0 58 58\" >\n                        <path d=\"M 44 28 C 43.448 28 43 28.447 43 29 L 43 35 C 43 42.72 36.72 49 29 49 C 21.28 49 15 42.72 15 35 L 15 29 C 15 28.447 14.552 28 14 28 C 13.448 28 13 28.447 13 29 L 13 35 C 13 43.485 19.644 50.429 28 50.949 L 28 56 L 23 56 C 22.448 56 22 56.447 22 57 C 22 57.553 22.448 58 23 58 L 35 58 C 35.552 58 36 57.553 36 57 C 36 56.447 35.552 56 35 56 L 30 56 L 30 50.949 C 38.356 50.429 45 43.484 45 35 L 45 29 C 45 28.447 44.552 28 44 28 Z\"/>\n                        <path id=\"micFilling\" d=\"M 28.97 44.438 L 28.97 44.438 C 23.773 44.438 19.521 40.033 19.521 34.649 L 19.521 11.156 C 19.521 5.772 23.773 1.368 28.97 1.368 L 28.97 1.368 C 34.166 1.368 38.418 5.772 38.418 11.156 L 38.418 34.649 C 38.418 40.033 34.166 44.438 28.97 44.438 Z\"/>\n                        <path d=\"M 29 46 C 35.065 46 40 41.065 40 35 L 40 11 C 40 4.935 35.065 0 29 0 C 22.935 0 18 4.935 18 11 L 18 35 C 18 41.065 22.935 46 29 46 Z M 20 11 C 20 6.037 24.038 2 29 2 C 33.962 2 38 6.037 38 11 L 38 35 C 38 39.963 33.962 44 29 44 C 24.038 44 20 39.963 20 35 L 20 11 Z\"/>\n                    </svg>\n                </button>\n            </div>\n        );\n    }\n}\n\nexport const Shell = connect(\n    (state: ChatState) => ({\n        // passed down to ShellContainer\n        inputText: state.shell.input,\n        showUploadButton: state.format.showUploadButton,\n        strings: state.format.strings,\n        // only used to create helper functions below\n        locale: state.format.locale,\n        user: state.connection.user,\n        listeningState: state.shell.listeningState\n    }), {\n        // passed down to ShellContainer\n        onChangeText: (input: string) => ({ type: 'Update_Input', input, source: \"text\" } as ChatActions),\n        stopListening:  () => ({ type: 'Listening_Stopping' }),\n        startListening:  () => ({ type: 'Listening_Starting' }),\n        // only used to create helper functions below\n        sendMessage,\n        sendFiles\n    }, (stateProps: any, dispatchProps: any, ownProps: any): Props => ({\n        // from stateProps\n        inputText: stateProps.inputText,\n        showUploadButton: stateProps.showUploadButton,\n        strings: stateProps.strings,\n        listeningState: stateProps.listeningState,\n        // from dispatchProps\n        onChangeText: dispatchProps.onChangeText,\n        // helper functions\n        sendMessage: (text: string) => dispatchProps.sendMessage(text, stateProps.user, stateProps.locale),\n        sendFiles: (files: FileList) => dispatchProps.sendFiles(files, stateProps.user, stateProps.locale),\n        startListening: () => dispatchProps.startListening(),\n        stopListening: () => dispatchProps.stopListening()\n    }), {\n        withRef: true\n    }\n)(ShellContainer);\n"]}